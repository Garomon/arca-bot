const fs=require(" fs\);const path=require(\path\);
const P={\BTC/USDT\:0.005,\SOL/USDT\:0.010,\DOGE/USDT\:0.012};
const D=path.join(__dirname,\../data/sessions\);
console.log(\--- PROGRESSIVE DCA ---\);if(fs.existsSync(D))fs.readdirSync(D).filter(f=>f.endsWith(\_state.json\)&&!f.includes(\back\)).forEach(f=>{try{const s=JSON.parse(fs.readFileSync(path.join(D,f)));const p=s.pair;if(!p||!P[p])return;
const{currentPrice:C,dcaBlockStartTime:T,inventory:I}=s;const cf=P[p];const inv=I||[];const amt=inv.reduce((a,b)=>a+(b.remaining||0),0);const cost=inv.reduce((a,b)=>a+((b.price||0)*(b.remaining||0)),0);const avg=amt>0?cost/amt:0;console.log(\\\n=== \+p+\ ===\);
console.log(\Price: \+C+\ Avg: \+avg.toFixed(4));if(avg<=0){console.log(\Status: BUYING\);return;}const dev=((C/avg)-1)*100;console.log(\Dev: \+dev.toFixed(2)+\%\);if(!T){console.log(\Status: ACTIVE\);return;}const h=(Date.now()-T)/36e5;const dyn=1+(cf*2.5);const base=Math.max(1.015,Math.min(dyn,1.05));const bump=Math.min(h/24,5)*0.01;const eff=Math.min(base+bump,1.10);const tgt=avg*eff;console.log(\Block: \+h.toFixed(1)+\h Buf: \+((eff-1)*100).toFixed(2)+\% Tgt: \+tgt.toFixed(4));if(C>tgt){if((C/avg)>1.10)console.log(\Forecast: Price above. Must drop.\);else{const nBump=(C/avg)-base;const nHrs=(nBump/0.01)*24;console.log(\Wait: ~\+Math.max(0,nHrs-h).toFixed(1)+\h\);}}else console.log(\Forecast: UNBLOCK\);}catch(e){console.log(e.message)}});
